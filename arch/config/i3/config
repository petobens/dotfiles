# Preamble {{{

# Define some keys as variables (super and alt)
set $mod Mod4
set $alt Mod1

# Variable to disable startup notifications (to be used with scripts)
set $nexec exec --no-startup-id

# Restart i3 inplace (preserving layout): this also reloads the config file
bindsym $mod+Control+a restart

# }}}
# Window handling {{{

# This prevents floating windows to bleed out from screen
floating_maximum_size 800 x 500

# Move a floating window with the mouse and pressing mod
floating_modifier $mod

# Layout (p for (p)iled)
workspace_layout tabbed
bindsym $mod+t layout tabbed
bindsym $mod+s layout toggle split

# Change layout
# bindsym $mod+w layout splith
# bindsym $mod+Control+w layout splitv
# bindsym $mod+d split h
# bindsym $mod+Control+d split v

# Toggle floating and tiling
# FIMXE: there is some other binding with this
#  TODO: To switch between floating and tiled use focus mode toggle
bindsym $mod+Control+space floating toggle

# Focus window
bindsym $mod+h focus left
bindsym $mod+l focus right
bindsym $mod+k focus up
bindsym $mod+j focus down

# Horizontal split
# bindsym $mod+h split h

# Vertical split
# bindsym $mod+v split v

# Full screen
bindsym $mod+Control+e fullscreen toggle

# Binding for resize
# FIXME: Don't use this!
bindsym $mod+r mode "resize"
mode "resize" {
    bindsym h resize shrink width 10 px or 10 ppt
    bindsym l resize grow width 10 px or 10 ppt
    bindsym k resize grow height 10 px or 10 ppt
    bindsym j resize shrink height 10 px or 10 ppt

    # back to normal: Enter or Escape or $mod+r
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+r mode "default"
}

#  }}}
#  Multiple monitors and workspaces {{{

#  FIXME: Find out why this is not read from PATH
bindsym $mod+Ctrl+Return $nexec $HOME/bin/dual

# Define names for default workspaces
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"

# Switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4

# Move focused container to workspace and switch focus to that container
bindsym $mod+Shift+1 move container to workspace $ws1; workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2; workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3; workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4; workspace $ws4

#  }}}
# Run or activate app and rules {{{

# Rofi (application launcher / switcher)
bindsym $alt+Tab $nexec $HOME/.config/i3/tab_switcher.sh
bindsym $mod+p $nexec "rofi -combi-modi drun,run -show combi"

# Run (includes screnshots)
bindsym $mod+Return $nexec alacritty
bindsym Print $nexec $HOME/bin/shots full
bindsym $mod+Shift+5 $nexec $HOME/bin/shots selection
bindsym $mod+Shift+6 $nexec $HOME/bin/shots active

# Run/Launch or focus (in specific workspace)
bindsym $mod+Ctrl+c $nexec raiseorlaunch -c Alacritty -w $ws2
bindsym $mod+Ctrl+i $nexec raiseorlaunch -c Chromium -w $ws1
bindsym $mod+Ctrl+l $nexec raiseorlaunch -c Slack -w $ws1
bindsym $mod+Ctrl+m $nexec raiseorlaunch -c Spotify -w $ws1
bindsym $mod+Ctrl+s $nexec raiseorlaunch -c Skype -e skypeforlinux -w $ws1
bindsym $mod+Ctrl+u $nexec raiseorlaunch -c Transmission-gtk -w $ws1

# Scratchpad
# TODO:

# Rules (use `xprop | grep -i 'class'` to actually get the class)
for_window [class="^Pavucontrol$"] floating enable, resize set 800 400, move position center
for_window [class="^Connman-gtk$"] floating enable, resize set 800 400, move position center

#  }}}
#  Spotify and volume {{{

bindsym $mod+Shift+p $nexec playerctl --player spotify play-pause
bindsym $mod+Shift+j $nexec playerctl --player spotify next
bindsym $mod+Shift+k $nexec playerctl --player spotify previous
bindsym $mod+Shift+t $nexec $HOME/.config/i3/spotify_track.py

bindsym $mod+Shift+plus $nexec "pactl set-sink-mute @DEFAULT_SINK@ false ; pactl set-sink-volume @DEFAULT_SINK@ +10%"
bindsym $mod+Shift+minus $nexec pactl set-sink-volume @DEFAULT_SINK@ -10%
bindsym $mod+Shift+m $nexec pactl set-sink-mute @DEFAULT_SINK@ toggle
bindsym $mod+Shift+v exec pavucontrol

#  }}}
# Theme and fonts {{{

# Disable title bar
font pango:Noto Sans 0

# Set window border width
for_window [class="^.*"] border pixel 2


# Theme
set $bg #24272e
set $border #282c34
set $fg #abb2bf
set $fg_high #d0d0d0
set $fg_urg #e06c75
#                       Border  Background Text     Indicator Child border
client.focused          $border $bg        $fg_high $fg       $border
client.focused_inactive $border $bg        $fg      $fg       $border
client.unfocused        $border $bg        $fg      $fg       $border
client.urgent           $border $bg        $fg_urg  $fg       $border
client.placeholder      $border $bg        $fg      $fg       $border
client.background       $border

#  }}}
# Miscellaneous {{{

# Kill focused window (as in mac); note that this quit apps that are minimized
# to sys tray (in this cases, such as slack, use ctrl-q to actually kill them)
bindsym $mod+q kill

# Shutdown, restart and lock
bindsym $mod+Shift+s $nexec $HOME/bin/gtk_dialog -t "Power Management" -m "Do you want to poweroff?" -a "systemctl poweroff"
bindsym $mod+Shift+r $nexec $HOME/bin/gtk_dialog -t "Power Management" -m "Do you want to reboot?" -a "systemctl reboot"
bindsym $mod+Shift+l $nexec $HOME/.config/i3/i3lock_fancy.sh

# Screen brightness
bindsym $mod+Shift+Right exec xbacklight -inc 10
bindsym $mod+Shift+Left exec xbacklight -dec 10

# Eject mounted media (usb drives)
bindsym $mod+Shift+e exec $HOME/bin/gtk_dialog -t "Media Management" -m "Do you want to eject media drive?" -a "udiskie-umount -a"

#  }}}
#  Startup {{{

# Use exec_always to relaunch polybar when restarting i3
exec_always --no-startup-id $HOME/.config/polybar/launch.py

#  }}}
